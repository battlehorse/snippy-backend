<html>
<head>
  <style>
    * {
      font-family: sans-serif;
      font-size: 11px;
    }

    P {
      border-top: 1px solid black;
      padding-top: 0.2em;
    }

    #not_ready_alert {
      border-top: 0;
      border-bottom: 1px solid black;
      margin: 0 0 0.5em 0;
    }

    IMG {
      vertical-align: text-bottom;
    }
  </style>
  <script>
    function toggle() {
      chrome.extension.getBackgroundPage().toggle();
      window.close();
    }
    function showDump() {
      chrome.extension.getBackgroundPage().toggleOff();
      chrome.extension.getBackgroundPage().showDump();
      window.close();
      return false;
    }
    function clearCopy() {
      chrome.extension.getBackgroundPage().clearCopy();
      window.close();
      return false;
    }

    function about() {
      chrome.extension.getBackgroundPage().about();
      window.close();
      return false;
    }

    function bug() {
      chrome.extension.getBackgroundPage().bug();
      window.close();
      return false;
    }

    function checkReadyness() {
      var ready_status = chrome.extension.getBackgroundPage().CurrentTabReadiness();
      if (ready_status == "unknown") {
        document.getElementById("not_ready_alert").innerHTML = "Please reload the page.";
        document.getElementById("snip_button").disabled = true;
        setTimeout("checkReadyness()", 100);
      } else if (ready_status == "ready") {
        document.getElementById("snip_button").disabled = false;
        document.getElementById("snip_text").innerHTML = "Snip it!";
        document.getElementById("not_ready_alert").style.display = "none";
      } else {  // loading
        document.getElementById("not_ready_alert").innerHTML = "Waiting for page to complete loading...";
        document.getElementById("snip_button").disabled = true;
        setTimeout("checkReadyness()", 100);
      } 
    }
  </script>
</head>
<body>
  <button id="snip_button" disabled="disabled" onclick="toggle()" style="width: 100px"><img src="snipit.png"><span id="snip_text">Not ready</span></button>
  <p id="not_ready_alert" style="display:block">
    Waiting for page to complete loading...
  </p>
  <a href="#" onclick="showDump()"><img src="showdump.png" style="border: 0">Show snippets</a>
  <p>
    <a href="#" onclick="clearCopy()"><img src="clearsnippets.png" style="border: 0">Clear snippets</a><br />
  </p>
  <p>
    <a href="#" onclick="about()"><img src="about.png" style="border: 0">About</a><br />
    <a href="#" onclick="bug()"><img src="bug.png" style="border: 0">Report bug</a><br />
  </p>
  <script>
    var cur_tab_url = chrome.extension.getBackgroundPage().CurrentTabUrl();
    if (/https:/.test(cur_tab_url)) {
      document.getElementById("not_ready_alert").innerHTML = "You can't grab snippets from secure webpages.";
    } else if (!/http:/.test(cur_tab_url)) {
      document.getElementById("not_ready_alert").innerHTML = "You can't grab snippets from this page.";
    } else {  // http
      checkReadyness();
    }
  </script>
</body>
</html>
